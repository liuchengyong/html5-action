function getActivityStatu(){var e={type:"3",uid:mui.getParameter("uid"),activityId:mui.getParameter("activityId")};$.ajax({type:"post",dataType:"json",url:page.basePath,data:{para:mui.DeEncode.myEncode(JSON.stringify(e))},success:function(e){"1"==e.code?page.gameOver=e.result.usableCount>0?!1:!0:"2"==e.code?page.gameOver=!0:"3"==e.code&&(page.gameOver=!0),mui.load.hide(),mui.screen.initImgLoction()},error:function(){}})}function refreshUserList(e){$("#luckUser").empty();for(var t in e){var i="";for(var n in page.prizes)if(page.prizes[n].name==e[t].prizeName){i=page.prizes[n].msg2;break}var r=new Date(e[t].createTime),a=r.format("MM.dd hh:mm"),s="";for(var c in e[t].name)s+=1==c?"*":e[t].name[c];var o="<div><span>"+a+"</span><span>"+s+i+"</span></div>";$("#luckUser").append(o)}}function getLotteryResult(){if(page.gameOver)return void $("#visited").transition({scale:1,duration:500,easing:"easeOutSine"});if(!page.isStart){page.isStart=!0;var e={type:"4",uid:mui.getParameter("uid"),activityId:mui.getParameter("activityId")};$.ajax({type:"post",dataType:"json",url:page.basePath,data:{para:mui.DeEncode.myEncode(JSON.stringify(e))},success:function(e){if("1"==e.code){page.gameOver=!1;var t={};for(var i in page.prizes)if(console.log("name:"+e.result.name),page.prizes[i].name==e.result.name){t=page.prizes[i];break}var n=Math.floor(4*Math.random())+4;page.pointAngle=360-page.angleCount%360+360*n+Math.floor(Math.random()*page.baseNUm)+t.angle.min,page.angleCount+=page.pointAngle,console.log("rounds:"+page.angleCount+"page.pointAngle:"+page.pointAngle+"usableCount:"+e.result.usableCount),$("#prize").transition({rotate:"+="+page.pointAngle,duration:2e3,easing:"easeOutSine",complete:function(){showResult(t.msg,1)}}),page.gameOver=e.result.usableCount>0?!1:!0}else"2"==e.code?$("#visited").transition({scale:1,duration:500,easing:"easeOutSine"}):"3"==e.code&&(page.gameOver=!0)},error:function(){}})}}function doOK(){$("#visited").transition({scale:0,duration:500,easing:"easeOutSine",complete:function(){page.isStart=!1}}),showResult("",0)}function showResult(e,t){$("#winning-text").text(e),$("#winning").transition({scale:t,duration:500,easing:"easeOutSine",complete:function(){0==t&&(page.isStart=!1)}})}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},$(function(){mui.screen.init(),document.getElementById("btn_rule").addEventListener("touchstart",function(){location="rule.html"+location.search}),document.getElementById("btn_rule").addEventListener("click",function(){location="rule.html"+location.search}),document.getElementById("btn_start").addEventListener("touchstart",getLotteryResult),document.getElementById("btn-winning-ok").addEventListener("touchstart",doOK),document.getElementById("btn-visited-ok").addEventListener("touchstart",doOK),getActivityStatu();setInterval(function(){var e={type:"5",uid:mui.getParameter("uid"),activityId:mui.getParameter("activityId")};$.ajax({type:"post",dataType:"json",url:page.basePath,data:{para:mui.DeEncode.myEncode(JSON.stringify(e))},success:function(e){"1"==e.code&&refreshUserList(e.result)},error:function(){}})},1e4)});var page={basePath:"http://api.highsq.com/UNIONACTIVITY/API/getLotteryActivity",gameOver:!1,isStart:!1,baseNUm:72,pointAngle:0,angleCount:0,prizes:[{name:"ipad mini4",angle:{min:-36,max:36},msg:"抽中ipad mini4一台",msg2:"获得ipad mini4一台"},{name:"10元话费",angle:{min:36,max:108},msg:"抽中10元手机充值卡",msg2:"获得10元手机充值卡"},{name:"5元话费",angle:{min:108,max:180},msg:"抽中5元手机充值卡",msg2:"获得5元手机充值卡"},{name:"30元购物券",angle:{min:180,max:252},msg:"抽中30元购物券",msg2:"获得30元购物券"},{name:"10元购物券",angle:{min:252,max:324},msg:"抽中10元购物券",msg2:"获得10元购物券"}]},mui={screen:{screenWidth:0,srceenHeight:0,imgWidth:720,imgHeight:1280,pageWidth:0,pageHeight:0,init:function(){mui.screen.screenWidth=$(window).width(),mui.screen.screenHeight=$(window).height();var e=mui.screen.imgWidth/mui.screen.imgHeight,t=mui.screen.screenWidth/mui.screen.screenHeight;e>t?(mui.screen.pageWidth=mui.screen.screenWidth,mui.screen.pageHeight=mui.screen.screenWidth/e):e==t?(mui.screen.pageWidth=mui.screen.screenWidth,mui.screen.pageHeight=mui.screen.screenHeight):t>e&&(mui.screen.pageWidth=mui.screen.screenHeight*e,mui.screen.pageHeight=mui.screen.screenHeight)},initImgLoction:function(){var e=mui.screen.pageWidth,t=mui.screen.pageHeight;$("#page").css({width:e+"px",height:t+"px","margin-left":-e/2+"px","margin-top":-t/2+"px"}),$("#bg").css({width:mui.screen.screenWidth+"px",height:mui.screen.screenHeight+"px",display:"block"});var i=0*t/mui.screen.imgHeight,n=12*e/mui.screen.imgWidth,r=85*t/mui.screen.imgHeight;$("#rule").css({top:i+"px",right:n+"px",height:r+"px",display:"block"});var a=77*t/mui.screen.imgHeight,s=57*t/mui.screen.imgHeight;$("#tip1").css({top:a+"px",height:s+"px",display:"block"});var c=148*t/mui.screen.imgHeight,o=110*t/mui.screen.imgHeight;$("#tip2").css({top:c+"px",height:o+"px",display:"block"});var g=e/2,m=700*t/mui.screen.imgHeight,u=544*e/mui.screen.imgWidth,h=544*t/mui.screen.imgHeight;$("#red").css({left:g-u/2+"px",top:m-h/2+"px",width:u+"px",height:h+"px",display:"block"});var d=475*e/mui.screen.imgWidth,p=475*t/mui.screen.imgHeight;$("#prize").css({left:g-d/2+"px",top:m-p/2+"px",width:d+"px",height:p+"px",display:"block"});var l=213*e/mui.screen.imgWidth,f=211*t/mui.screen.imgHeight;$("#point").css({left:g-l/2+"px",top:m-f/2+"px",width:l+"px",height:f+"px",display:"block"});{var v=50*t/mui.screen.imgHeight;49*e/mui.screen.imgWidth,205*t/mui.screen.imgHeight,624*e/mui.screen.imgWidth}$("#luck").css({bottom:v+"px",width:e+"px",display:"block"});{var x=45*t/mui.screen.imgHeight;25*e/mui.screen.imgWidth}$("#luck").css({"line-height":x+"px"}),$("#visited-shadow").css({display:"block"});var y=550*e/mui.screen.imgWidth,b=670*t/mui.screen.imgHeight,C=mui.screen.screenWidth/2-y/2,w=mui.screen.screenHeight/2-b/2;$("#visited-back").css({left:C+"px",top:w+"px",width:y+"px",height:b+"px",display:"block"});var E=280*e/mui.screen.imgWidth,H=80*t/mui.screen.imgHeight,k=mui.screen.screenWidth/2-E/2,S=w+534*b/670;$("#visited-ok").css({left:k+"px",top:S+"px",width:E+"px",height:H+"px",display:"block"}),$("#winning-shadow").css({display:"block"});var A=660*e/mui.screen.imgWidth,W=700*t/mui.screen.imgHeight,O=mui.screen.screenWidth/2-A/2,D=mui.screen.screenHeight/2-W/2;$("#winning-back").css({left:O+"px",top:D+"px",width:A+"px",height:W+"px",display:"block"});var I=50*t/mui.screen.imgHeight,z=625*t/mui.screen.imgHeight;$("#winning-text").css({top:z+"px",height:I+"px","font-size":I-5+"px",display:"block"});var L=280*e/mui.screen.imgWidth,M=80*t/mui.screen.imgHeight,N=mui.screen.screenWidth/2-L/2,P=D+560*W/700;$("#winning-ok").css({left:N+"px",top:P+"px",width:L+"px",height:M+"px",display:"block"}),$("#visited").css({scale:0}),$("#winning").css({scale:0})}},DeEncode:{keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",base64:{encode:function(e){var t,i,n,r,a,s=mui.DeEncode.keyStr,c="",o="",g="",m=0;do t=e.charCodeAt(m++),i=e.charCodeAt(m++),o=e.charCodeAt(m++),n=t>>2,r=(3&t)<<4|i>>4,a=(15&i)<<2|o>>6,g=63&o,isNaN(i)?a=g=64:isNaN(o)&&(g=64),c=c+s.charAt(n)+s.charAt(r)+s.charAt(a)+s.charAt(g),t=i=o="",n=r=a=g="";while(m<e.length);return c},decode:function(e){var t,i,n,r,a,s=mui.DeEncode.keyStr,c="",o="",g="",m=0;if(e.length%4!=0)return"";var u=/[^A-Za-z0-9\+\/\=]/g;if(u.exec(e))return"";do n=s.indexOf(e.charAt(m++)),r=s.indexOf(e.charAt(m++)),a=s.indexOf(e.charAt(m++)),g=s.indexOf(e.charAt(m++)),t=n<<2|r>>4,i=(15&r)<<4|a>>2,o=(3&a)<<6|g,c+=String.fromCharCode(t),64!=a&&(c+=String.fromCharCode(i)),64!=g&&(c+=String.fromCharCode(o)),t=i=o="",n=r=a=g="";while(m<e.length);return c}},utf16to8:function(e){var t,i,n,r;for(t="",n=e.length,i=0;n>i;i++)r=e.charCodeAt(i),r>=1&&127>=r?t+=e.charAt(i):r>2047?(t+=String.fromCharCode(224|r>>12&15),t+=String.fromCharCode(128|r>>6&63),t+=String.fromCharCode(128|r>>0&63)):(t+=String.fromCharCode(192|r>>6&31),t+=String.fromCharCode(128|r>>0&63));return t},utf8to16:function(e){var t,i,n,r,a,s;for(t="",n=e.length,i=0;n>i;)switch(r=e.charCodeAt(i++),r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(i-1);break;case 12:case 13:a=e.charCodeAt(i++),t+=String.fromCharCode((31&r)<<6|63&a);break;case 14:a=e.charCodeAt(i++),s=e.charCodeAt(i++),t+=String.fromCharCode((15&r)<<12|(63&a)<<6|(63&s)<<0)}return t},stringToBytes:function(e){for(var t,i,n=[],r=0;r<e.length;r++){t=e.charCodeAt(r),i=[];do i.push(255&t),t>>=8;while(t);n=n.concat(i.reverse())}return n},myEncode:function(e){for(var t="liulibinzxc@lx100$#365#$",i=mui.DeEncode.stringToBytes(mui.DeEncode.utf16to8(t)),n=mui.DeEncode.stringToBytes(mui.DeEncode.utf16to8(e)),r="",a=0;a<n.length;a++){for(var s=0;s<i.length;s++)n[a]=n[a]^i[s];r+=String.fromCharCode(n[a])}return mui.DeEncode.base64.encode(r)},myDecode:function(e){for(var t="liulibinzxc@lx100$#365#$",i=mui.DeEncode.stringToBytes(mui.DeEncode.utf16to8(t)),n=mui.DeEncode.stringToBytes(mui.DeEncode.base64.decode(e)),r="",a=0;a<n.length;a++){for(var s=0;s<i.length;s++)n[a]=n[a]^i[s];r+=String.fromCharCode(n[a])}return mui.DeEncode.utf8to16(r)}},getParameter:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null},load:{hide:function(){$("#loading").css("display","none")}}};